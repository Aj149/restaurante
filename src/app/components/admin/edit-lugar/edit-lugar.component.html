<div class="container mt-4 mb-4">
  <div class="text-center">
    <img src="../../../../assets/cubiertos formulario.png" alt="">
    <h1 class="nautilus">FOOD FUNDAY</h1>
    <h2 class="roboto tomate text-white">RESTAURANTE GOURMET</h2>
  </div>
  <div class="text-center mt-1 mb-1">
    <h4 class="roboto">Editar {{lugar.nombre}}</h4>
  </div>
  <form (ngSubmit)="guardarCambios()">
    <div class="row">
      <div class="col-6 form-group">
        <label for="nombre">Nombre</label>
        <input type="text" id="nombre" class="form-control" [(ngModel)]="lugar.nombre" name="nombre" required>
      </div>
      <div class="col-6 form-group">
        <label for="precio">Precio</label>
        <input type="number" id="precio" class="form-control" [(ngModel)]="lugar.precio" name="precio" required>
      </div>

      <div class="col-6 form-group">
        <label for="dia">Día</label>
        <select id="dia" class="form-control" [(ngModel)]="diaSeleccionado" name="dia" (change)="onDiaChange()"
          required>
          <option value="" disabled selected>Selecciona un día</option>
          @for (dia of diasSemana; track dia) {
          <option [value]="dia">{{ dia }}</option>
          }
        </select>
      </div>
      @if (horariosDelDia.length > 0) {
  <div class="mt-4">
    <h5 class="mb-3 text-secondary">Horarios disponibles para <span class="fw-bold">{{ diaSeleccionado }}</span>:</h5>
    <ul class="list-group shadow-sm rounded">
      @for (horario of horariosDelDia; track horario) {
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <span class="me-2 fw-semibold">{{ horario.horaInicio }}</span> - 
            <span class="mx-2">{{ horario.horaFin }}</span>
            <span 
              class="badge rounded-pill ms-3" 
              [class.bg-success]="horario.estado === 'Disponible'"
              [class.bg-danger]="horario.estado === 'Ocupado'">
              {{ horario.estado }}
            </span>
          </div>
          <button type="button" class="btn btn-sm btn-outline-primary" (click)="abrirEdicion(horario)">
            Editar
          </button>
        </li>
      }
    </ul>
  </div>
}

      <div class="mt-3">
      @if (horarioEditado) {
        <h5>Editar horario</h5>
        <div class="col-6 form-group mt-3">
          <label for="horaInicio">Hora Inicio</label>
          <input type="time" id="horaInicio" class="form-control" [(ngModel)]="horarioEditado.horaInicio"
            name="horaInicio" required min="07:00" max="21:00">
        </div>
        <div class="col-6 form-group">
          <label for="horaFin">Hora Fin</label>
          <input type="time" id="horaFin" class="form-control" [(ngModel)]="horarioEditado.horaFin" name="horaFin"
            required min="07:00" max="21:00">
        </div>
        <div class="col-6 form-group">
          <label for="estado">Disponibilidad</label>
          <select id="estado" class="form-control" [(ngModel)]="horarioEditado.estado" name="estado" required>
            <option value="" disabled selected>Selecciona estado</option>
            <option value="Disponible">Disponible</option>
            <option value="Ocupado">Ocupado</option>
          </select>
        </div>
      }
    </div>
    <app-edit-horarios 
      *ngIf="horarioParaEditar" 
      [horario]="horarioParaEditar" 
      (guardar)="onHorarioGuardado($event)" 
      (cancelar)="horarioParaEditar = null">
    </app-edit-horarios>
      <div class="mb-3">
        <label for="descripcion" class="form-label">Descripción</label>
        <textarea id="descripcion" class="form-control" [(ngModel)]="lugar.descripcion" name="descripcion" rows="3"
          maxlength="320" #descripcion="ngModel" required></textarea>
        <small class="text-muted">
          {{ descripcion.value?.length || 0 }} / 320 caracteres
        </small>
        @if (descripcion.value?.length === 320) {
        <div class="text-danger">
          ¡Has alcanzado el límite de caracteres!
        </div>
        }
      </div>
      <div class="mb-3" class="form-group">
        <label for="imagen">Imagen (URL o base64)</label>
        <input type="text" id="imagen" class="form-control" [(ngModel)]="lugar.imagen" name="imagen">
      </div>
      @if (lugar.imagen) {
      <div class="mb-3 text-center mt-3">
        <img [src]="lugar.imagen" class="img-thumbnail" alt="Vista previa" style="max-height: 200px;">
      </div>
      }
      <div class="d-flex justify-content-center mt-4 mb-4">
        <div class="w-50 d-flex justify-content-between gap-3">
          <button class="btn btn-sm btn-outline-primary flex-fill">
            Guardar Cambios
          </button>
          <button class="btn btn-sm btn-outline-danger flex-fill" (click)="volver()">
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </form>